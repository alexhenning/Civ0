<html><title>Civ 0--Civilization: Year 0, a JavaScript open-source implementation of a civilization-style game</title>
<body>
<script type="text/javascript">

var Debug = 1;

function Rand(X){
   return(Math.floor(Math.random()*X+1));
}

function Distance(Row1, Col1, Row2, Col2){
   return Math.sqrt(Math.pow(Row1-Row2,2)+Math.pow(Col1-Col2,2));
}

var Terrain = new Array();
Ocean = 0;
Terrain[Ocean] = {symbol: "o", food: 1, production: 0, trade: 2, movementCost: 1, defense: 1};
Glacier = 1;
Terrain[Glacier] = {symbol: "c", food: 0, production: 0, trade: 0, movementCost: 2, defense: 1};
Tundra = 2;
Terrain[Tundra] = {symbol: "t", food: 1, production: 0, trade: 0, movementCost: 1, defense: 1};
Plains = 3;
Terrain[Plains] = {symbol: "p", food: 1, production: 1, trade: 0, movementCost: 1, defense: 1};
Grassland = 4;
Terrain[Grassland] = {symbol: "g", food: 2, production: 0, trade: 0, movementCost: 1, defense: 1};
Forest = 5;
Terrain[Forest] = {symbol: "f", food: 1, production: 2, trade: 0, movementCost: 2, defense: 1.5};
Swamp = 6;
Terrain[Swamp] = {symbol: "s", food: 1, production: 0, trade: 0, movementCost: 2, defense: 1.5};
Jungle = 7;
Terrain[Jungle] = {symbol: "j", food: 1, production: 0, trade: 0, movementCost: 3, defense: 1.5};
Desert = 8;
Terrain[Desert] = {symbol: "d", food: 0, production: 1, trade: 0, movementCost: 1, defense: 1};
Hills = 9;
Terrain[Hills] = {symbol: "h", food: 1, production: 0, trade: 0, movementCost: 2, defense: 2};
Mountains = 10;
Terrain[Mountains] = {symbol: "m", food: 0, production: 1, trade: 0, movementCost: 3, defense: 3};
TerrainSymbol = new Array();
for (X=Ocean; X<=Mountains; X++){
   TerrainSymbol[Terrain[X].symbol] = X;
   //alert(X + ", '" + Terrain[X].symbol + "', " + TerrainSymbol[Terrain[X].symbol]);
}


var LostAtSeaLikelihood = 25;

var Tech = new Array();
AdvancedFlight = 1;
Alphabet = 2;
AmphibiousWarfare = 3;
Astronomy = 4;
AtomicTheory = 5;
Automobile = 6;
Banking = 7;
BridgeBuilding = 8;
BronzeWorking = 9;
CeremonialBurial = 10;
Chemistry = 11;
Chivalry = 12;
CityBuilding = 13;
CodeofLaws = 14;
CombinedArms = 15;
Combustion = 16;
Communism = 17;
Computers = 18;
Conscription = 19;
Construction = 20;
Currency = 21;
Democracy = 22;
Economics = 23;
Electricity = 24;
Electronics = 25;
Engineering = 26;
Environmentalism = 27;
Espionage = 28;
Explosives = 29;
Feudalism = 30;
Flight = 31;
Fundamentalism = 32;
FusionPower = 33;
GeneticEngineering = 34;
GuerillaWarfare = 35;
Gunpowder = 36;
HorsebackRiding = 37;
Industrialization = 38;
Invention = 39;
IronWorking = 40;
LaborUnion = 41;
Laser = 42;
Leadership = 43;
Literacy = 44;
MachineTools = 45;
Magnetism = 46;
MapMaking = 47;
Masonry = 48;
MassProduction = 49;
Mathematics = 50;
Medicine = 51;
Metallurgy = 52;
Miniaturization = 53;
MobileWarfare = 54;
Monarchy = 55;
Monotheism = 56;
Mysticism = 57;
Navigation = 58;
NuclearFission = 59;
NuclearPower = 60;
Philosophy = 61;
Physics = 62;
Plastics = 63;
Polytheism = 64;
Pottery = 65;
Radio = 66;
Railroad = 67;
Recycling = 68;
Refining = 69;
Refrigeration = 70;
Robotics = 71;
Rocketry = 72;
Sanitation = 73;
Seafaring = 74;
SpaceFlight = 75;
Stealth = 76;
SteamEngine = 77;
Steel = 78;
Superconductors = 79;
Tactics = 80;
TheCorporation = 81;
TheRepublic = 82;
TheWheel = 83;
Theology = 84;
TheoryofGravity = 85;
Trade = 86;
University = 87;
WarriorCode = 88;
Writing = 89;
Tech[AdvancedFlight] = {name: 'Advanced Flight', prereq1: Radio, prereq2: MachineTools, playerOwned: false, AIOwned: false, code: ""};
Tech[Alphabet] = {name: 'Alphabet', prereq1: CityBuilding, prereq2: CityBuilding, playerOwned: false, AIOwned: false, code: ""};
Tech[AmphibiousWarfare] = {name: 'Amphibious Warfare', prereq1: Navigation, prereq2: Tactics, playerOwned: false, AIOwned: false, code: ""};
Tech[Astronomy] = {name: 'Astronomy', prereq1: Mysticism, prereq2: Mathematics, playerOwned: false, AIOwned: false, code: ""};
Tech[AtomicTheory] = {name: 'Atomic Theory', prereq1: TheoryofGravity, prereq2: Physics, playerOwned: false, AIOwned: false, code: ""};
Tech[Automobile] = {name: 'Automobile', prereq1: Combustion, prereq2: Steel, playerOwned: false, AIOwned: false, code: ""};
Tech[Banking] = {name: 'Banking', prereq1: Trade, prereq2: TheRepublic, playerOwned: false, AIOwned: false, code: ""};
Tech[BridgeBuilding] = {name: 'Bridge Building', prereq1: IronWorking, prereq2: Construction, playerOwned: false, AIOwned: false, code: ""};
Tech[BronzeWorking] = {name: 'Bronze Working', prereq1: CityBuilding, prereq2: CityBuilding, playerOwned: false, AIOwned: false, code: ""};
Tech[CeremonialBurial] = {name: 'Ceremonial Burial', prereq1: CityBuilding, prereq2: CityBuilding, playerOwned: false, AIOwned: false, code: ""};
Tech[Chemistry] = {name: 'Chemistry', prereq1: University, prereq2: Medicine, playerOwned: false, AIOwned: false, code: ""};
Tech[Chivalry] = {name: 'Chivalry', prereq1: Feudalism, prereq2: HorsebackRiding, playerOwned: false, AIOwned: false, code: ""};
Tech[CityBuilding] = {name: 'City Building', prereq1: CityBuilding, prereq2: CityBuilding, playerOwned: true, AIOwned: true, code: ""};
Tech[CodeofLaws] = {name: 'Code of Laws', prereq1: Alphabet, prereq2: CityBuilding, playerOwned: false, AIOwned: false, code: ""};
Tech[CombinedArms] = {name: 'Combined Arms', prereq1: MobileWarfare, prereq2: AdvancedFlight, playerOwned: false, AIOwned: false, code: ""};
Tech[Combustion] = {name: 'Combustion', prereq1: Refining, prereq2: Explosives, playerOwned: false, AIOwned: false, code: ""};
Tech[Communism] = {name: 'Communism', prereq1: Philosophy, prereq2: Industrialization, playerOwned: false, AIOwned: false, code: ""};
Tech[Computers] = {name: 'Computers', prereq1: MassProduction, prereq2: Miniaturization, playerOwned: false, AIOwned: false, code: ""};
Tech[Conscription] = {name: 'Conscription', prereq1: Democracy, prereq2: Metallurgy, playerOwned: false, AIOwned: false, code: ""};
Tech[Construction] = {name: 'Construction', prereq1: Masonry, prereq2: Currency, playerOwned: false, AIOwned: false, code: ""};
Tech[Currency] = {name: 'Currency', prereq1: BronzeWorking, prereq2: CityBuilding, playerOwned: false, AIOwned: false, code: ""};
Tech[Democracy] = {name: 'Democracy', prereq1: Banking, prereq2: Invention, playerOwned: false, AIOwned: false, code: ""};
Tech[Economics] = {name: 'Economics', prereq1: Banking, prereq2: University, playerOwned: false, AIOwned: false, code: ""};
Tech[Electricity] = {name: 'Electricity', prereq1: Metallurgy, prereq2: Magnetism, playerOwned: false, AIOwned: false, code: ""};
Tech[Electronics] = {name: 'Electronics', prereq1: TheCorporation, prereq2: Electricity, playerOwned: false, AIOwned: false, code: ""};
Tech[Engineering] = {name: 'Engineering', prereq1: TheWheel, prereq2: Construction, playerOwned: false, AIOwned: false, code: ""};
Tech[Environmentalism] = {name: 'Environmentalism', prereq1: Recycling, prereq2: SpaceFlight, playerOwned: false, AIOwned: false, code: ""};
Tech[Espionage] = {name: 'Espionage', prereq1: Communism, prereq2: Democracy, playerOwned: false, AIOwned: false, code: ""};
Tech[Explosives] = {name: 'Explosives', prereq1: Gunpowder, prereq2: Chemistry, playerOwned: false, AIOwned: false, code: ""};
Tech[Feudalism] = {name: 'Feudalism', prereq1: WarriorCode, prereq2: Monarchy, playerOwned: false, AIOwned: false, code: ""};
Tech[Flight] = {name: 'Flight', prereq1: Combustion, prereq2: TheoryofGravity, playerOwned: false, AIOwned: false, code: ""};
Tech[Fundamentalism] = {name: 'Fundamentalism', prereq1: Theology, prereq2: Conscription, playerOwned: false, AIOwned: false, code: ""};
Tech[FusionPower] = {name: 'Fusion Power', prereq1: NuclearPower, prereq2: Superconductors, playerOwned: false, AIOwned: false, code: ""};
Tech[GeneticEngineering] = {name: 'Genetic Engineering', prereq1: Medicine, prereq2: TheCorporation, playerOwned: false, AIOwned: false, code: ""};
Tech[GuerillaWarfare] = {name: 'Guerilla Warfare', prereq1: Communism, prereq2: Tactics, playerOwned: false, AIOwned: false, code: ""};
Tech[Gunpowder] = {name: 'Gunpowder', prereq1: Invention, prereq2: IronWorking, playerOwned: false, AIOwned: false, code: ""};
Tech[HorsebackRiding] = {name: 'Horseback Riding', prereq1: CityBuilding, prereq2: CityBuilding, playerOwned: false, AIOwned: false, code: ""};
Tech[Industrialization] = {name: 'Industrialization', prereq1: Railroad, prereq2: Banking, playerOwned: false, AIOwned: false, code: "TransportClass=ModernTransport;"};
Tech[Invention] = {name: 'Invention', prereq1: Engineering, prereq2: Literacy, playerOwned: false, AIOwned: false, code: ""};
Tech[IronWorking] = {name: 'Iron Working', prereq1: BronzeWorking, prereq2: WarriorCode, playerOwned: false, AIOwned: false, code: ""};
Tech[LaborUnion] = {name: 'Labor Union', prereq1: MassProduction, prereq2: GuerillaWarfare, playerOwned: false, AIOwned: false, code: ""};
Tech[Laser] = {name: 'Laser', prereq1: MassProduction, prereq2: NuclearPower, playerOwned: false, AIOwned: false, code: ""};
Tech[Leadership] = {name: 'Leadership', prereq1: Chivalry, prereq2: Gunpowder, playerOwned: false, AIOwned: false, code: ""};
Tech[Literacy] = {name: 'Literacy', prereq1: Writing, prereq2: CodeofLaws, playerOwned: false, AIOwned: false, code: ""};
Tech[MachineTools] = {name: 'Machine Tools', prereq1: Steel, prereq2: Tactics, playerOwned: false, AIOwned: false, code: ""};
Tech[Magnetism] = {name: 'Magnetism', prereq1: IronWorking, prereq2: Physics, playerOwned: false, AIOwned: false, code: "TransportClass=Galleon; LostAtSeaLikelihood = LostAtSeaLikelihood*2/3;"};
Tech[MapMaking] = {name: 'Map Making', prereq1: Alphabet, prereq2: CityBuilding, playerOwned: false, AIOwned: false, code: "TransportClass=Trireme; LostAtSeaLikelihood = LostAtSeaLikelihood*2/3;"};
Tech[Masonry] = {name: 'Masonry', prereq1: CityBuilding, prereq2: CityBuilding, playerOwned: false, AIOwned: false, code: ""};
Tech[MassProduction] = {name: 'Mass Production', prereq1: Automobile, prereq2: TheCorporation, playerOwned: false, AIOwned: false, code: ""};
Tech[Mathematics] = {name: 'Mathematics', prereq1: Alphabet, prereq2: Masonry, playerOwned: false, AIOwned: false, code: ""};
Tech[Medicine] = {name: 'Medicine', prereq1: Philosophy, prereq2: Trade, playerOwned: false, AIOwned: false, code: ""};
Tech[Metallurgy] = {name: 'Metallurgy', prereq1: Gunpowder, prereq2: University, playerOwned: false, AIOwned: false, code: ""};
Tech[Miniaturization] = {name: 'Miniaturization', prereq1: MachineTools, prereq2: Electronics, playerOwned: false, AIOwned: false, code: ""};
Tech[MobileWarfare] = {name: 'Mobile Warfare', prereq1: Automobile, prereq2: Tactics, playerOwned: false, AIOwned: false, code: ""};
Tech[Monarchy] = {name: 'Monarchy', prereq1: CeremonialBurial, prereq2: CodeofLaws, playerOwned: false, AIOwned: false, code: ""};
Tech[Monotheism] = {name: 'Monotheism', prereq1: Philosophy, prereq2: Polytheism, playerOwned: false, AIOwned: false, code: ""};
Tech[Mysticism] = {name: 'Mysticism', prereq1: CeremonialBurial, prereq2: CityBuilding, playerOwned: false, AIOwned: false, code: ""};
Tech[Navigation] = {name: 'Navigation', prereq1: Seafaring, prereq2: Astronomy, playerOwned: false, AIOwned: false, code: "TransportClass=Caravel; LostAtSeaLikelihood = LostAtSeaLikelihood*2/3;"};
Tech[NuclearFission] = {name: 'Nuclear Fission', prereq1: MassProduction, prereq2: AtomicTheory, playerOwned: false, AIOwned: false, code: ""};
Tech[NuclearPower] = {name: 'Nuclear Power', prereq1: NuclearFission, prereq2: Electronics, playerOwned: false, AIOwned: false, code: ""};
Tech[Philosophy] = {name: 'Philosophy', prereq1: Mysticism, prereq2: Literacy, playerOwned: false, AIOwned: false, code: ""};
Tech[Physics] = {name: 'Physics', prereq1: Literacy, prereq2: Navigation, playerOwned: false, AIOwned: false, code: ""};
Tech[Plastics] = {name: 'Plastics', prereq1: Refining, prereq2: SpaceFlight, playerOwned: false, AIOwned: false, code: ""};
Tech[Polytheism] = {name: 'Polytheism', prereq1: HorsebackRiding, prereq2: CeremonialBurial, playerOwned: false, AIOwned: false, code: ""};
Tech[Pottery] = {name: 'Pottery', prereq1: CityBuilding, prereq2: CityBuilding, playerOwned: false, AIOwned: false, code: ""};
Tech[Radio] = {name: 'Radio', prereq1: Flight, prereq2: Electricity, playerOwned: false, AIOwned: false, code: ""};
Tech[Railroad] = {name: 'Railroad', prereq1: SteamEngine, prereq2: BridgeBuilding, playerOwned: false, AIOwned: false, code: ""};
Tech[Recycling] = {name: 'Recycling', prereq1: MassProduction, prereq2: Democracy, playerOwned: false, AIOwned: false, code: ""};
Tech[Refining] = {name: 'Refining', prereq1: Chemistry, prereq2: TheCorporation, playerOwned: false, AIOwned: false, code: ""};
Tech[Refrigeration] = {name: 'Refrigeration', prereq1: Sanitation, prereq2: Electricity, playerOwned: false, AIOwned: false, code: ""};
Tech[Robotics] = {name: 'Robotics', prereq1: MobileWarfare, prereq2: Computers, playerOwned: false, AIOwned: false, code: ""};
Tech[Rocketry] = {name: 'Rocketry', prereq1: AdvancedFlight, prereq2: Electronics, playerOwned: false, AIOwned: false, code: ""};
Tech[Sanitation] = {name: 'Sanitation', prereq1: Engineering, prereq2: Medicine, playerOwned: false, AIOwned: false, code: ""};
Tech[Seafaring] = {name: 'Seafaring', prereq1: Pottery, prereq2: MapMaking, playerOwned: false, AIOwned: false, code: "LostAtSeaLikelihood = LostAtSeaLikelihood*2/3;"};
Tech[SpaceFlight] = {name: 'Space Flight', prereq1: Computers, prereq2: Rocketry, playerOwned: false, AIOwned: false, code: ""};
Tech[Stealth] = {name: 'Stealth', prereq1: Superconductors, prereq2: AdvancedFlight, playerOwned: false, AIOwned: false, code: ""};
Tech[SteamEngine] = {name: 'Steam Engine', prereq1: Physics, prereq2: Invention, playerOwned: false, AIOwned: false, code: ""};
Tech[Steel] = {name: 'Steel', prereq1: Electricity, prereq2: Industrialization, playerOwned: false, AIOwned: false, code: ""};
Tech[Superconductors] = {name: 'Superconductors', prereq1: NuclearPower, prereq2: Laser, playerOwned: false, AIOwned: false, code: ""};
Tech[Tactics] = {name: 'Tactics', prereq1: Conscription, prereq2: Leadership, playerOwned: false, AIOwned: false, code: ""};
Tech[TheCorporation] = {name: 'The Corporation', prereq1: Economics, prereq2: Industrialization, playerOwned: false, AIOwned: false, code: ""};
Tech[TheRepublic] = {name: 'The Republic', prereq1: CodeofLaws, prereq2: Literacy, playerOwned: false, AIOwned: false, code: ""};
Tech[TheWheel] = {name: 'The Wheel', prereq1: HorsebackRiding, prereq2: CityBuilding, playerOwned: false, AIOwned: false, code: ""};
Tech[Theology] = {name: 'Theology', prereq1: Feudalism, prereq2: Monotheism, playerOwned: false, AIOwned: false, code: ""};
Tech[TheoryofGravity] = {name: 'Theory of Gravity', prereq1: Astronomy, prereq2: University, playerOwned: false, AIOwned: false, code: ""};
Tech[Trade] = {name: 'Trade', prereq1: Currency, prereq2: CodeofLaws, playerOwned: false, AIOwned: false, code: ""};
Tech[University] = {name: 'University', prereq1: Mathematics, prereq2: Philosophy, playerOwned: false, AIOwned: false, code: ""};
Tech[WarriorCode] = {name: 'Warrior Code', prereq1: CityBuilding, prereq2: CityBuilding, playerOwned: false, AIOwned: false, code: ""};
Tech[Writing] = {name: 'Writing', prereq1: Alphabet, prereq2: CityBuilding, playerOwned: false, AIOwned: false, code: ""};

CurrentTech = CityBuilding;
CurrentTechCost = 0;
TechReserve = 0;
TechCount = 0;

var Product = new Array();
Settler = 1; Product[Settler] = {type: 'unit', name: 'Settler', imgStub: 'settler', prereq: CityBuilding, cost: 40, class: 'EI', mobility: 1, attack: 0, defense: 1, health: 10, firepower: 1, obsolete: false};
Warrior = 2; Product[Warrior] = {type: 'unit', name: 'Warrior', imgStub: 'warrior', prereq: CityBuilding, cost: 10, class: 'EI', mobility: 1, attack: 1, defense: 1, health: 10, firepower: 1, obsolete: false};
Horseman = 3; Product[Horseman] = {type: 'unit', name: 'Horseman', imgStub: 'horseman', prereq: HorsebackRiding, cost: 20, class: 'EC', mobility: 2, attack: 2, defense: 1, health: 10, firepower: 1, obsolete: false};
Archer = 4; Product[Archer] = {type: 'unit', name: 'Archer', imgStub: 'archer', prereq: WarriorCode, cost: 30, class: 'EI', mobility: 1, attack: 3, defense: 2, health: 10, firepower: 1, obsolete: false};
Phalanx = 5; Product[Phalanx] = {type: 'unit', name: 'Phalanx', imgStub: 'phalanx', prereq: BronzeWorking, cost: 20, class: 'HI', mobility: 1, attack: 1, defense: 2, health: 10, firepower: 1, obsolete: false};
Chariot = 6; Product[Chariot] = {type: 'unit', name: 'Chariot', imgStub: 'chariot', prereq: TheWheel, cost: 30, class: 'EC', mobility: 2, attack: 3, defense: 1, health: 10, firepower: 1, obsolete: false};
Catapult = 7; Product[Catapult] = {type: 'unit', name: 'Catapult', imgStub: 'catapult', prereq: Mathematics, cost: 40, class: 'SE', mobility: 1, attack: 6, defense: 1, health: 10, firepower: 1, obsolete: false};
Legion = 8; Product[Legion] = {type: 'unit', name: 'Legion', imgStub: 'legion', prereq: IronWorking, cost: 40, class: 'HI', mobility: 1, attack: 4, defense: 2, health: 10, firepower: 1, obsolete: false};
Pikeman = 9; Product[Pikeman] = {type: 'unit', name: 'Pikeman', imgStub: 'pikeman', prereq: Feudalism, cost: 20, class: 'HI', mobility: 1, attack: 1, defense: 2, health: 10, firepower: 1, obsolete: false};
Knight = 10; Product[Knight] = {type: 'unit', name: 'Knight', imgStub: 'knight', prereq: Chivalry, cost: 40, class: 'EC', mobility: 2, attack: 4, defense: 2, health: 10, firepower: 1, obsolete: false};
Frigate = 11; Product[Frigate] = {type: 'unit', name: 'Frigate', imgStub: 'frigate', prereq: Magnetism, cost: 50, class: 'N', mobility: 4, attack: 4, defense: 2, health: 20, firepower: 1, obsolete: false};
Ironclad = 12; Product[Ironclad] = {type: 'unit', name: 'Ironclad', imgStub: 'ironclad', prereq: SteamEngine, cost: 60, class: 'N', mobility: 4, attack: 4, defense: 4, health: 30, firepower: 1, obsolete: false};
Musketeer = 13; Product[Musketeer] = {type: 'unit', name: 'Musketeer', imgStub: 'musketeer', prereq: Gunpowder, cost: 30, class: 'LI', mobility: 1, attack: 3, defense: 3, health: 20, firepower: 1, obsolete: false};
Dragoon = 14; Product[Dragoon] = {type: 'unit', name: 'Dragoon', imgStub: 'dragoon', prereq: Leadership, cost: 50, class: 'EC', mobility: 2, attack: 5, defense: 2, health: 20, firepower: 1, obsolete: false};
Cannon = 15; Product[Cannon] = {type: 'unit', name: 'Cannon', imgStub: 'cannon', prereq: Metallurgy, cost: 40, class: 'SE', mobility: 1, attack: 8, defense: 1, health: 20, firepower: 1, obsolete: false};
Destroyer = 16; Product[Destroyer] = {type: 'unit', name: 'Destroyer', imgStub: 'destroyer', prereq: Electricity, cost: 60, class: 'N', mobility: 6, attack: 4, defense: 4, health: 30, firepower: 1, obsolete: false};
Rifleman = 17; Product[Rifleman] = {type: 'unit', name: 'Rifleman', imgStub: 'rifleman', prereq: Conscription, cost: 40, class: 'LI', mobility: 1, attack: 4, defense: 4, health: 20, firepower: 1, obsolete: false};
Cavalry = 18; Product[Cavalry] = {type: 'unit', name: 'Cavalry', imgStub: 'cavalry', prereq: Tactics, cost: 60, class: 'LC', mobility: 2, attack: 8, defense: 3, health: 20, firepower: 1, obsolete: false};
Cruiser = 19; Product[Cruiser] = {type: 'unit', name: 'Cruiser', imgStub: 'cruiser', prereq: Steel, cost: 80, class: 'N', mobility: 5, attack: 6, defense: 6, health: 30, firepower: 2, obsolete: false};
Battleship = 20; Product[Battleship] = {type: 'unit', name: 'Battleship', imgStub: 'battleship', prereq: Automobile, cost: 160, class: 'N', mobility: 4, attack: 12, defense: 12, health: 40, firepower: 2, obsolete: false};
Submarine = 21; Product[Submarine] = {type: 'unit', name: 'Submarine', imgStub: 'submarine', prereq: Combustion, cost: 50, class: 'N', mobility: 5, attack: 15, defense: 2, health: 30, firepower: 2, obsolete: false};
Artillery = 22; Product[Artillery] = {type: 'unit', name: 'Artillery', imgStub: 'artillery', prereq: MachineTools, cost: 50, class: 'SE', mobility: 1, attack: 10, defense: 1, health: 20, firepower: 2, obsolete: false};
Fighter = 23; Product[Fighter] = {type: 'unit', name: 'Fighter', imgStub: 'fighter', prereq: Flight, cost: 60, class: 'AF', mobility: 10, attack: 4, defense: 3, health: 20, firepower: 2, obsolete: false};
Carrier = 24; Product[Carrier] = {type: 'unit', name: 'Carrier', imgStub: 'carrier', prereq: AdvancedFlight, cost: 160, class: 'N', mobility: 5, attack: 1, defense: 9, health: 40, firepower: 2, obsolete: false};
Armor = 25; Product[Armor] = {type: 'unit', name: 'Armor', imgStub: 'armor', prereq: MobileWarfare, cost: 80, class: 'LC', mobility: 3, attack: 10, defense: 5, health: 30, firepower: 1, obsolete: false};
MechInf = 26; Product[MechInf] = {type: 'unit', name: 'Mech. Inf.', imgStub: 'mech_inf', prereq: LaborUnion, cost: 50, class: 'LI', mobility: 3, attack: 6, defense: 6, health: 30, firepower: 1, obsolete: false};
Howitzer = 27; Product[Howitzer] = {type: 'unit', name: 'Howitzer', imgStub: 'howitzer', prereq: Robotics, cost: 70, class: 'SE', mobility: 2, attack: 12, defense: 2, health: 30, firepower: 2, obsolete: false};
Bomber = 28; Product[Bomber] = {type: 'unit', name: 'Bomber', imgStub: 'bomber', prereq: AdvancedFlight, cost: 120, class: 'AF', mobility: 8, attack: 12, defense: 1, health: 20, firepower: 2, obsolete: false};
SpyPlane = 29; Product[SpyPlane] = {type: 'unit', name: 'Spy Plane', imgStub: 'spy_plane', prereq: AdvancedFlight, cost: 140, class: 'AF', mobility: 16, attack: 0, defense: 1, health: 20, firepower: 1, obsolete: false};
NuclearMissile = 30; Product[NuclearMissile] = {type: 'unit', name: 'Nuclear Missile', imgStub: 'nuclear_missile', prereq: Rocketry, cost: 160, class: 'M', mobility: 16, attack: 99, defense: 0, health: 10, firepower: 1, obsolete: false};
CruiseMissile = 31; Product[CruiseMissile] = {type: 'unit', name: 'Cruise Missile', imgStub: 'cruise_missile', prereq: Rocketry, cost: 60, class: 'M', mobility: 12, attack: 18, defense: 0, health: 10, firepower: 1, obsolete: false};
StealthBomber = 32; Product[StealthBomber] = {type: 'unit', name: 'Stealth Bomber', imgStub: 'stealth_bomber', prereq: Stealth, cost: 160, class: 'AF', mobility: 12, attack: 18, defense: 5, health: 20, firepower: 2, obsolete: false};
StealthFighter = 33; Product[StealthFighter] = {type: 'unit', name: 'Stealth Fighter', imgStub: 'stealth_fighter', prereq: Stealth, cost: 80, class: 'AF', mobility: 14, attack: 8, defense: 4, health: 20, firepower: 2, obsolete: false};

var Transport = new Array();
Boat = 1; Transport[Boat] = {type: 'unit', name: 'Boat', imgStub: 'boat', prereq: CityBuilding, cost: 40, class: 'N', mobility: 2, attack: 0, defense: 1, health: 10, firepower: 1, transportCapacity: 2, obsolete: false};
Trireme = 2; Transport[Trireme] = {type: 'unit', name: 'Trireme', imgStub: 'trireme', prereq: MapMaking, cost: 40, class: 'N', mobility: 3, attack: 1, defense: 1, health: 10, firepower: 1, transportCapacity: 2, obsolete: false};
Caravel = 3; Transport[Caravel] = {type: 'unit', name: 'Caravel', imgStub: 'caravel', prereq: Navigation, cost: 40, class: 'N', mobility: 3, attack: 2, defense: 1, health: 10, firepower: 1, transportCapacity: 3, obsolete: false};
Galleon = 4; Transport[Galleon] = {type: 'unit', name: 'Galleon', imgStub: 'galleon', prereq: Magnetism, cost: 40, class: 'N', mobility: 4, attack: 0, defense: 2, health: 20, firepower: 1, transportCapacity: 4, obsolete: false};
ModernTransport = 5; Transport[ModernTransport] = {type: 'unit', name: 'Transport', imgStub: 'transport', prereq: Industrialization, cost: 50, class: 'N', mobility: 5, attack: 0, defense: 3, health: 30, firepower: 1, transportCapacity: 8, obsolete: false};
TransportClass = Boat;

MaxRow = 24;
MaxCol = 30; //prompt("How wide a world is it?","30");
StartRow = 0;
StartCol = 0;

var Region = new Array();
TerrainProbability = new Array("ttc","ttttc", "tppp", "pppgfs", "gfs", "jjsgg", "jjjssg", "gggd", "dddgg");

var City = new Array();

var Unit = new Array();

function TerrainAtLatitude(Row){
   switch (Rand(20)){
      case 1: return Mountains; break;
      case 2: return Hills; break;
      default:
         Latitude = Math.floor(Row/MaxRow*17);
         if (Latitude>8){Latitude = 17-Latitude};
         Choices = String(TerrainProbability[Latitude]);
         Choice = Choices.charAt(Rand(Choices.length)-1);
         //if (Debug){Debug = confirm(Choice + ": " + TerrainSymbol[Choice] + ". Continue debugging?");}
         return TerrainSymbol[Choice];
   }
}

function RegionImage(Row, Col, focus){
   var S = 'p'+Row+'_'+Col;
   var T;
   var U = Region[Row][Col].unit;
   if(Unit[U] !== undefined){
      if (Unit[U].player){
         if (focus){
            T = "focus";
            document.getElementById(S).focus();
         }else{
            T = "player";
         }
      }else{
         T = "enemy";
      }
      if (Region[Row][Col].terrain!=Ocean){
         /* Error: Unit[U] is undefined -- occured after ship lost at sea */
         document.getElementById(S).src=Product[Unit[U].type].imgStub+"_"+T+".png";
      }else{
         document.getElementById(S).src=Transport[Unit[U].transportClass].imgStub+"_"+T+".png";
      }
   }else{
      if(Region[Row][Col].city!=-1){
         document.getElementById(S).src="city_player.png";
      }else{
         document.getElementById(S).src=Terrain[Region[Row][Col].terrain].symbol+".png";
      }
   }
}

function GenerateMap(Region){

   for (Row=-1; Row<=MaxRow+1; Row++){
      Region[Row] = new Array();
   }

   // sea by default
   for (Row=-1; Row<=MaxRow+1; Row++){
      for (Col=-1; Col<=MaxCol+1; Col++){
         Region[Row][Col] = {terrain: Ocean, unit: -1, city: -1};
      }
   }
   // glaciers
   for (Col=-1; Col<MaxCol+1; Col++){
      Region[0][Col].terrain = Glacier;
      if (Rand(3)==1){
         Region[1][Col].terrain = Glacier;
      }
      if (Rand(6)==1){
         Region[MaxRow-2][Col].terrain = Glacier;
      }
	  Region[MaxRow-1][Col].terrain = Glacier;
   }


   Land1 = Rand(6)+5;
   LandEnd1 = Land1+Rand(5)+Rand(5);
   LandOffset2 = Rand(6)+10;
   Land2 = LandEnd1+LandOffset2;
   LandEnd2 = Math.min(Land2+Rand(5)+Rand(5),MaxCol);
   // insert a channel at the narrowest point
   NarrowestWidth = MaxCol;
   NarrowestRow = MaxRow;
   for (Row=1; Row<MaxRow-3; Row++){
      for (Col=Land1; Col<=LandEnd1; Col++){
         Region[Row][Col].terrain = TerrainAtLatitude(Row);
      }
      if (Row>Rand(4)) {
         for (Col=Land2; Col<=LandEnd2; Col++){
            Region[Row][Col].terrain = TerrainAtLatitude(Row);
         }
         if ((Row>4) & (LandEnd1-Land1>=2) & (StartRow==0)){
            StartRow = Row;
            StartCol = Land1+Rand(LandEnd1-Land1-1);
         }
      }
      Land1 = Math.max(Land1+Rand(5)-3,1);
      LandEnd1 = LandEnd1+Rand(3)-2;
      if (LandEnd1<Land1-1){
         LandEnd1=Land1+Rand(5)+5;
      	 NarrowestRow=Row;
      }
      if ((Row>3+Rand(3))&&(LandEnd1-Land1<NarrowestWidth)){
         NarrowestWidth=LandEnd1-Land1;
         NarrowestRow=Row;
      }
      Land2 = LandEnd1+LandOffset2+Rand(3)-2;
      LandEnd2 = Math.min(LandEnd2+Rand(5)-3,MaxCol);
   }
   for (Col=0; Col<MaxCol/2; Col++){
      Region[NarrowestRow][Col].terrain = Ocean;
   }

}


/* Units */
function DeleteUnit(U){
   if(U+1<Unit.length){
      Unit[U] = Unit[Unit.length-1];
      ActiveUnit=0;
   }
   Unit.pop();
}


/* Nations */

PlayerCityName = new Array("Babylon", "Lagash", "Nippur", "Ur", "Kish", "Shuruppak", "Kisurra", "Cutha", "Adab", "Umma", "Akkad", "Eridu", "Larsa", "Borsippa", "Sippar", "Nineveh", "Ashur", "Calach", "Carcar", "Hamat",  "Opis", "Cunaxa", "Arbela", "Nisibis", "Carrhae", "Seleucia", "Ctesiphon", "Sittace", "Orchoe", "Apamea");
PlayerCity = 0;


/* Cities */


function CitySiteString(Row,Col,Food,Production,Trade){
   if (Region[Row][Col].terrain!=Ocean){
      Food = 0;
      Production = 0;
      Trade = 0;
      for (var A=-1; A<=1; A++){
         for (var B=-1; B<=1; B++){
            Food += Terrain[Region[Row+A][Col+B].terrain].food;
            Production += Terrain[Region[Row+A][Col+B].terrain].production;
            Trade += Terrain[Region[Row+A][Col+B].terrain].trade;
         }
      }
      return ("City has potential for "+(Food+Production+Trade)+" points ("+Food+"f/"+Production+"p/"+Trade+"t)");
   }else{
      return("");
   }
}

function FoundCity(Row,Col,Player){
   Food = 0; Production=0; Trade=0;
   CitySiteString(Row,Col,Food,Production,Trade);
   City.push({name: "Unnamed", foodReserve: 0, productionReserve: 0, row: Row, col: Col, food: Food, production: Production, trade: Trade, product: Warrior, citizens: 2});
   Region[Row][Col].city = City.length-1;
   RegionImage(Row, Col, false)
   if (Player){
      City[City.length-1].name = PlayerCityName[PlayerCity];
      PlayerCity++;
      if (Unit[1].city=-1){
         Unit[1].city=City.length-1;
         RegionImage(Unit[1].row, Unit[1].col, false);
      }
   }
   return (City[City.length-1].name + ", 2 citizens");
}


/* UI */

var ActiveUnit = 0;

function MenuPrompt(Message, Menu){
   for (X=0; X<Menu.length; X++){
      Message += (X+1)+". "+Menu[X].name+", ";
   }
   Message = Message.substring(0,Message.length-2);
   X = prompt(Message);
   if ((1<=X)&(X<=Menu.length)){
      return (Menu[X-1].value);
   }else{
      return (Menu[0].value);
   }
}

function NextTech(){
   if (TechReserve>=CurrentTechCost){
      TechReserve -= CurrentTechCost;
   	  Tech[CurrentTech].playerOwned = true;
   	  if (Tech[CurrentTech].code!="") eval(Tech[CurrentTech].code);
      TechCount++;
      var Menu = new Array();
      for (X=AdvancedFlight; X<=Writing; X++){
         if (!Tech[X].playerOwned & Tech[Tech[X].prereq1].playerOwned & Tech[Tech[X].prereq2].playerOwned){
            Menu.push({name: Tech[X].name, value: X});
         }
      }
      X = MenuPrompt("Your scientists have discovered "+Tech[CurrentTech].name + ". What should they research next? ", Menu);
      CurrentTech = X;
   }
   TechReserve++; /* TBD: factor in trade progress */
   CurrentTechCost = TechCount;
}


function NextProduct(C){
   if (City[C].productionReserve>=Product[City[C].product].cost){
      City[C].productionReserve -= Product[City[C].product].cost;
      Unit.push({type: City[C].product, row: City[C].row, col: City[C].col, movement: Product[City[C].product].mobility, active: true, player: true, city: C, transportClass: TransportClass});
      var Menu = new Array();
      for (X=StealthFighter; X>=Settler; X--){
         if (Tech[Product[X].prereq].playerOwned){
            Menu.push({name: Product[X].name, value: X});
         }
      }
      X = MenuPrompt(City[C].name+" has built "+Product[City[C].product].name+". What should they build next? ", Menu);
      City[C].product = X;
   }
}

function Turn(){
   //alert("starting loop with "+ActiveUnit+" and Unit.length of "+Unit.length);
   while ((ActiveUnit>0) && ((!Unit[ActiveUnit].active) || (Unit[ActiveUnit].movement==0))){
      ActiveUnit--;
   }
   //alert("Active Unit = " + ActiveUnit);
   if ((Unit[ActiveUnit].active) & (Unit[ActiveUnit].movement)){
      RegionImage(Unit[ActiveUnit].row, Unit[ActiveUnit].col, true);
   }else{
      for (U=0; U<Unit.length; U++){
         if (Unit[U].active){
            Unit[U].movement = Product[Unit[U].type].mobility;
         }
      }
      NextTech();
      for (C=0; C<City.length; C++){
         City[C].productionReserve += Math.max(City[C].production/City[C].citizens,1);
         NextProduct(C);
      }
      ActiveUnit = Unit.length-1;
      while (ActiveUnit && ((!Unit[ActiveUnit].active) || (!Unit[ActiveUnit].movement))){
         ActiveUnit--;
      }
      if (!ActiveUnit && !Unit[ActiveUnit].active){
         for (U=0; U<Unit.length; U++){
            if (Unit[U].player){
               Unit[U].active = true;
               Unit[U].movement = Product[Unit[U].type].mobility;
            }
         }
      }
      ActiveUnit = Unit.length-1;
      while (ActiveUnit && ((!Unit[ActiveUnit].active) || (!Unit[ActiveUnit].movement))){
         ActiveUnit--;
      }
      if (!ActiveUnit && !Unit[ActiveUnit].active){
         alert("All your units are destroyed. Game over.")
         ActiveUnit=-1;
      }else{
         RegionImage(Unit[ActiveUnit].row, Unit[ActiveUnit].col, true);
      }
   }
}


function i(item, Row, Col){
   if ((Row==Unit[ActiveUnit].row) & (Col==Unit[ActiveUnit].col)){
      if (Unit[ActiveUnit].type==Settler){
         if (confirm("Build a city here? " + CitySiteString(Row,Col) + ".")){
            item.src="city_player.png";
            item.title=FoundCity(Row,Col,true);
            DeleteUnit(ActiveUnit);
            Turn();
         }
      }else{
         if(confirm("Put the unit on sentry duty (standby)?")){
            Unit[ActiveUnit].active = false;
            Unit[ActiveUnit].movement = 0;
            item.src=Product[Unit[ActiveUnit].type].imgStub+"_player.png";
            Turn();
         }
      }
   }else{
      if ((Distance(Row, Col, Unit[ActiveUnit].row, Unit[ActiveUnit].col)<=Math.min(Unit[ActiveUnit].movement,1.5)) & (Region[Row][Col].unit==-1)){
         Region[Unit[ActiveUnit].row][Unit[ActiveUnit].col].unit = -1;
         LostAtSea = ((Region[Row][Col].terrain==Ocean) && (Region[Unit[ActiveUnit].row][Unit[ActiveUnit].col].terrain==Ocean) && (Rand(100)*Unit[ActiveUnit].movement<=LostAtSeaLikelihood));
         if (LostAtSea){
            alert("This unit was lost at sea.");
            DeleteUnit(ActiveUnit);
         }else{
            Unit[ActiveUnit].row = Row;
            Unit[ActiveUnit].col = Col;
            Unit[ActiveUnit].movement = Math.max(0,Unit[ActiveUnit].movement-Terrain[Region[Row][Col].terrain].movementCost);
            Region[Row][Col].unit = ActiveUnit;
         }
         for (A=-1; A<=1; A++){
            for (B=-1; B<=1; B++){
               //alert(Region[X+A][Y+B].terrain);
               var S = 'p'+(Row+A)+'_'+(Col+B);
               if ((A*B!=0) && (document.getElementById(S).src.indexOf('u.png')!=-1) && (Unit[ActiveUnit].city!=-1) && (Rand(Math.abs(Row-City[Unit[ActiveUnit].city].row))>3)){
                  // Barbarians
                  Unit.push({type: Rand(4)+1, row: Row+A, col: Col+B, movement: 0, active: false, player: false, city: -1, health: 10, transportClass: Math.min(ModernTransport,TransportClass+Rand(2)-1)});
                  Region[Row+A][Col+B].unit = Unit.length-1;
                  document.getElementById(S).title = "Barbarian "+Product[Unit[Unit.length-1].type].name+", health 10";
               }
               RegionImage(Row+A, Col+B, false);
               if(!LostAtSea && (Unit[ActiveUnit].type==Settler)){
                  document.getElementById(S).title = CitySiteString(Row+A,Col+B);
               }
            }
         }
         Turn();
      }else{
		 RegionImage(Unit[ActiveUnit].row, Unit[ActiveUnit].col, true);
      }
   }
}

for (Row=0; Row<MaxRow; Row++){
   for (Col=0; Col<MaxCol; Col++){
   	  document.write('<img src=u.png id=p', Row,'_', Col,' onclick="i(this,', Row, ',', Col, ')">');
   }
   document.writeln("<br>");
}
GenerateMap(Region);

/* Preload images */
for (X=Ocean; X<=Mountains; X++){
   document.getElementById('p0_'+X).src = Terrain[X].symbol+".png";
}
document.getElementById('p0_0').src = "city_player.png";
for (X=Ocean; X<=Mountains; X++){
   document.getElementById('p0_'+X).src = "u.png";
}

for (Row=StartRow-1; Row<=StartRow+1; Row++){
   for (Col=StartCol-1; Col<=StartCol+2; Col++){
      document.getElementById('p'+Row+"_"+Col).src = Terrain[Region[Row][Col].terrain].symbol+".png";
   }
}

document.getElementById('p'+StartRow+"_"+StartCol).src = "settler_player.png";
document.getElementById('p'+StartRow+"_"+(StartCol+1)).src = "warrior_player.png";
Unit[0] = {type: Settler, row: StartRow, col: StartCol, movement: 1, active: true, player: true, city: -1, transportClass: Boat};
Unit[1] = {type: Warrior, row: StartRow, col: StartCol+1, movement: 1, active: true, player: true, city: -1, transportClass: Boat};
Region[StartRow][StartCol].unit = 0;
Region[StartRow][StartCol+1].unit = 1;

NextTech();
Turn();


//set up Unit and City to start at 0 with -1 for none
//rename Transport Troopship

</script>
</body>
</html>

